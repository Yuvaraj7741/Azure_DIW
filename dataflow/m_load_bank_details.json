{
   "name" : "m_load_bank_details",
   "properties" : {
      "type" : "MappingDataFlow",
      "typeProperties" : {
         "sources" : [ {
            "dataset" : {
               "referenceName" : "LKPTRANS",
               "type" : "DatasetReference"
            },
            "name" : "LKPTRANS_1",
            "script" : "source(output(\n\t\tbnk_id as string,\n\t\tbnk_name as string,\n\t\taddress as string,\n\t\tcity as string,\n\t\tstate_code as string,\n\t\tcontact_no as string,\n\t\tno_of_branches as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false) ~> LKPTRANS_1"
         }, {
            "dataset" : {
               "referenceName" : "load_bnk_src",
               "type" : "DatasetReference"
            },
            "name" : "load_bnk_src",
            "script" : "source(output(\n\t\tbnk_id as string,\n\t\tbnk_name as string,\n\t\taddress as string,\n\t\tcity as string,\n\t\tstate_code as string,\n\t\tcontact_no as string,\n\t\tno_of_branches as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false) ~> load_bnk_src"
         } ],
         "sinks" : [ {
            "dataset" : {
               "referenceName" : "load_bnk_src1",
               "type" : "DatasetReference"
            },
            "name" : "load_bnk_src1",
            "script" : "SEQTRANS sink(saveMode:'overwrite' ) ~> load_bnk_src1"
         } ],
         "transformations" : [ {
            "name" : "EXPTRANS",
            "script" : "load_bnk_src derive(upper_bnk_name = upper(bnk_name)) ~> EXPTRANS"
         }, {
            "name" : "EXPTRANS1",
            "script" : "EXPTRANS, LKPTRANS derive() ~> EXPTRANS1"
         }, {
            "name" : "SRTTRANS",
            "script" : "EXPTRANS1 sort(asc(upper_bnk_name,true),\n\tasc(address,true),\n\tasc(city,true),\n\tasc(contact_no,true),\n\tasc(no_of_branches,true)) ~> SRTTRANS"
         }, {
            "name" : "AGGTRANS",
            "script" : "SRTTRANS aggregate(\n\tgroupBy(bnk_name = bnk_name),\n\t\tavg_branches = average(no_of_branches)) ~> AGGTRANS"
         }, {
            "name" : "SEQTRANS",
            "script" : "AGGTRANS keyGenerate(output(s_no as long),\n\tstartAt: 1L) ~> SEQTRANS"
         }, {
            "name" : "LKPTRANS",
            "script" : "EXPTRANS, LKPTRANS_1 lookup(load_bnk_src@bnk_id == LKPTRANS_1@bnk_id,\n\tbroadcast: 'none') ~> LKPTRANS"
         } ]
      }
   }
}